<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Camera Integration</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=83bfuniegk&submodules=panorama,geocoder,drawing,visualization"></script>
    <style type="text/css">
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #wrap {
            position: relative;
            width: 820px;
            height: 820px;
            border: 1px solid #000; /* Optional: for visibility */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* Optional: for styling */
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .buttons {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
            padding: 5px;
        }

        .control-btn {
            margin: 0 5px 5px 0;
        }
    </style>
</head>

<body>
    <div id="wrap">
        <div id="map">
            <div class="buttons">
                <input id="cadastral" type="button" value="지적도" class="control-btn" />
                <button id="openCameraBtn" class="control-btn">카메라 열기</button>
            </div>
        </div>
    </div>

    <!-- 실시간 비디오를 보여줄 요소 -->
    <video id="video" width="600" height="400" autoplay></video>

    <script>
        // 카메라 열기 버튼과 비디오 요소 가져오기
        const openCameraBtn = document.getElementById('openCameraBtn');
        const video = document.getElementById('video');

        // 카메라 열기 버튼 클릭 시 실행될 함수
        openCameraBtn.addEventListener('click', async function () {
            try {
                // 카메라 스트림 열기
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                // 비디오 요소에 스트림 설정
                video.srcObject = stream;
            } catch (error) {
                console.error("카메라를 열 수 없습니다:", error);
            }
        });

        // 현재 위치 기반으로 지도 초기화
        navigator.geolocation.getCurrentPosition(function (position) {
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;

            // 사용자의 현재 위치를 중심으로 지도를 초기화
            var map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(lat, lon),
                mapTypeControl: true,
                zoom: 18,
                mapTypeControlOptions: {
                    style: naver.maps.MapTypeControlStyle.DROPDOWN
                }
            });

            // 사용자의 현재 위치에 마커 설정
            var marker = new naver.maps.Marker({
                position: naver.maps.LatLng(lat, lon),
                map: map,
                icon: {
                    url: 'https://github.com/SungSoo-VIRNECT/NaverCadastralMaps/blob/main/docs/img/example/brown.png',
                    size: new naver.maps.Size(25, 34),
                    scaledSize: new naver.maps.Size(25, 34),
                    origin: new naver.maps.Point(0, 0),
                    anchor: new naver.maps.Point(12, 34)
                }
            });

            var cadastralLayer = new naver.maps.CadastralLayer();
            var btn = document.getElementById('cadastral');

            // 지적도 레이어 변경 이벤트 처리
            naver.maps.Event.addListener(map, 'cadastralLayer_changed', function () {
                if (cadastralLayer.getMap()) {
                    btn.classList.add('control-on');
                    btn.value = '지적도 끄기';
                } else {
                    btn.classList.remove('control-on');
                    btn.value = '지적도 켜기';
                }
            });

            // 버튼 클릭 시 지적도 레이어 토글
            btn.addEventListener('click', function (e) {
                e.preventDefault();

                if (cadastralLayer.getMap()) {
                    cadastralLayer.setMap(null);
                    btn.value = '지적도 켜기';
                } else {
                    cadastralLayer.setMap(map);
                    btn.value = '지적도 끄기';
                }
            });

            // 초기화 시 지적도 레이어 설정
            naver.maps.Event.once(map, 'init', function () {
                cadastralLayer.setMap(map);
            });
        });
    </script>
</body>

</html>