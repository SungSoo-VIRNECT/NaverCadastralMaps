<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Cadastral Map</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=83bfuniegk&submodules=panorama,geocoder,drawing,visualization"></script>
    <style type="text/css">
        #wrap {
            position: relative;
            width: 820px;
            height: 820px;
            margin: 0 auto;
        }

        #wrap .buttons {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
            padding: 5px;
        }

        #wrap .buttons .control-btn {
            margin: 0 5px 5px 0;
        }

        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="wrap" class="section">
        <div id="map">
            <div class="buttons">
                <input id="cadastral" type="button" value="지적도" class="control-btn" />
                
            </div>
        </div>
    </div>

    <script>
        // 사용자의 현재 위치를 기반으로 지도를 초기화하는 함수
        function initMapWithCurrentLocation() {
            navigator.geolocation.getCurrentPosition(function (position) {
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;

                // 지도 초기화
                var map = new naver.maps.Map('map', {
                    center: new naver.maps.LatLng(lat, lon), // 사용자의 현재 위치를 중심으로 설정
                    // mapTypeControl: true,
                    zoom: 24,
                    // mapTypeControlOptions: {
                    //     style: naver.maps.MapTypeControlStyle.DROPDOWN
                    // }
                });

                // 마커 추가
                var marker = new naver.maps.Marker({
                    position: new naver.maps.LatLng(lat, lon),
                    map: map,
                    icon: {
                        url: 'https://github.com/SungSoo-VIRNECT/NaverCadastralMaps/blob/main/docs/img/example/brown.png',
                        size: new naver.maps.Size(25, 34),
                        scaledSize: new naver.maps.Size(25, 34),
                        origin: new naver.maps.Point(0, 0),
                        anchor: new naver.maps.Point(12, 34)
                    }
                });

                // 지적도 레이어 토글을 위한 변수 및 이벤트 핸들러 설정
                var cadastralLayer = new naver.maps.CadastralLayer();
                var btn = document.getElementById('cadastral');

                naver.maps.Event.addListener(map, 'cadastralLayer_changed', function () {
                    if (cadastralLayer.getMap()) {
                        btn.classList.add('control-on');
                        btn.value = '지적도 끄기';
                    } else {
                        btn.classList.remove('control-on');
                        btn.value = '지적도 켜기';
                    }
                });

                btn.addEventListener('click', function (e) {
                    e.preventDefault();

                    if (cadastralLayer.getMap()) {
                        cadastralLayer.setMap(null);
                        btn.value = '지적도 켜기';
                    } else {
                        cadastralLayer.setMap(map);
                        btn.value = '지적도 끄기';
                    }
                });

                naver.maps.Event.once(map, 'init', function () {
                    cadastralLayer.setMap(map);
                });
            }, function (error) {
                console.error("Error getting location: ", error);
                alert("현재 위치를 가져올 수 없습니다. 위치 권한을 허용해 주세요.");
            });
        }

        // 현재 위치로 지도 초기화
        initMapWithCurrentLocation();
    </script>
</body>

</html>